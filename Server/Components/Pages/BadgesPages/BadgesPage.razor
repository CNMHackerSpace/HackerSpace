@page "/Badges"
@rendermode InteractiveServer
@using SharedClasses.Models;
@using System.Security.Claims
@inject HttpClient http
@inject NavigationManager navManager
@inject IBadgesDAL dal
<h3>Badges</h3>

@if(_badges == null)
{
    <p>
        ...Loading badges &nbsp;
        <img src="/images/Spur_gears_animation_blue_small.gif" height="30" />
    </p>
}
else if(_badges.Count() == 0)
{
    <p>No badges in database at this time.</p>
}
else
{
    @foreach(SharedClasses.Models.HackerspaceBadge badge in _badges)
    {
        <p>
            <a href="/Badge/@badge.Id">
                <img src="UploadedImages/@badge.FileName" height="50" />
                @badge.Title</a>

            <AuthorizeView Roles="admin">
                <Authorized><button class="btn btn-danger" type="button" @onclick="(()=>OnDeleteBadgeClickedAsync(badge))">Delete Badge</button></Authorized>
            </AuthorizeView>
        </p>
    }
}
<AuthorizeView Roles="admin, badgecreator">
    <Authorized><button class="btn btn-primary" type="button" @onclick="OnAddBadgeClicked">Add Badge</button></Authorized>
</AuthorizeView>


<ConfirmDialog @ref="dialog" />
@code {
    private ConfirmDialog dialog = default!;

    private List<SharedClasses.Models.HackerspaceBadge>? _badges;

    protected async override Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        _badges = await dal.GetAllAsync();
    }

    protected void OnAddBadgeClicked()
    {
        navManager.NavigateTo("/Badge/0");
    }

    protected async Task OnDeleteBadgeClickedAsync(SharedClasses.Models.HackerspaceBadge badge)
    {
        var confirmation = await dialog.ShowAsync(
            title: "Are you sure you want to delete this badge?",
            message1: "This will delete the record. Once deleted can not be rolled back.",
            message2: "Do you want to proceed?");

        if (confirmation)
        {
            Console.WriteLine("OK Clicked");
            await dal.DeleteAsync(badge.Id);
            _badges?.Remove(badge);
        }
        else
        {
            Console.WriteLine("Cancel Clicked");
        }
    }
}