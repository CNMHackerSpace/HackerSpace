@page "/UserProfile"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using Shared.Models;
@attribute [Authorize]
@inject HttpClient Http

<PageTitle>User Profile</PageTitle>
<h3>User Profile</h3>
@if(user != null)
{
    <p>Name: @user.Name</p>
    <p>Email: @user.Email</p>
}
@if(roles != null)
{
    <ul>
        @foreach(var role in roles)
        {
            <li>@role.Role</li>
        }
    </ul>
}

<p>@status</p>
@code {
    string status = "Obtaining user information.";
    UserProfile? user;
    IEnumerable<UserRole>? roles;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            user = await Http.GetFromJsonAsync<UserProfile>("/api/User");
            roles = await Http.GetFromJsonAsync<IEnumerable<UserRole>>("/api/Roles");
            status = "User information obtained.";
        }
        catch (AccessTokenNotAvailableException exception)
        {
            exception.Redirect();
        }
    }
}
